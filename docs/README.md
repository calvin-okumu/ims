# Banking Access Control System with ZKTECO Integration

## Overview

This is a Next.js-based Banking Access Control System that integrates with the ZKTECO BioCVSecurity API to manage private banking customers and their spouses' access to specific areas. Accounts are stored in SQLite, with automatic access revocation on status changes.

## Features

- Register banking accounts with principal and spouse details
- Automatic fingerprint and card registration for both
- Assign "VIP Lounge" access level with door controls
- Status-based access management (active/inactive)
- Fetch and display personnel and accounts
- RESTful API integration with error handling and loading states
- Responsive UI built with Tailwind CSS and TypeScript

## Tech Stack

- **Frontend**: Next.js 16, React 19, TypeScript
- **Backend**: SQLite (better-sqlite3) for data persistence
- **API Proxy**: Next.js API routes for CORS/SSL handling
- **Styling**: Tailwind CSS
- **HTTP Client**: Axios with custom HTTPS agent
- **API**: ZKTECO BioCVSecurity API v2.0 (via proxy)
- **Authentication**: Access token via URL parameters
- **Data Sync**: Automatic refresh with manual controls

## Setup

### Prerequisites

1. **ZKBio CVSecurity Server**: Ensure your ZKBio CVSecurity server is running and accessible
2. **API Authorization Setup**: Configure API access in ZKBio admin panel (see below)
3. **Network Access**: Ensure the application server can reach the ZKBio server

### ZKBio API Authorization Setup

Follow these steps to configure API authorization in your ZKBio CVSecurity admin panel:

#### Step 1: Access ZKBio Admin Panel

1. Open your web browser and navigate to your ZKBio CVSecurity server:
   ```
   https://192.168.183.114:8098
   ```

2. Log in with superuser credentials:
   - **Username**: `admin` (or your superuser account)
   - **Password**: `#eCOM@786SEC` (or your configured password)

#### Step 2: Navigate to API Authorization

1. In the admin panel, go to:
   ```
   System â†’ Authority Management â†’ API Authorization
   ```

2. You should see the API Authorization management page.

#### Step 3: Create New API Client

1. Click the **New** button at the upper part of the list.

2. Configure the API client:
   - **Client ID**: Enter a unique identifier (e.g., `banking-system-api`)
   - **Client Secret**: This will be auto-generated by the system

3. **Important**: Save the generated **Client Secret** - this is your API token!

#### Step 4: Enable API Access

1. After creating the client, click **Browse API** on the API Authorization page.

2. This opens the API operation page - keep this page open for normal API access.

3. **Note**: If client ID and secret are not properly configured, API access will be abnormal.

### Application Setup

1. Clone the repository.
2. Install dependencies: `npm install`
3. Create `.env.local` with your ZKBio API credentials:
   ```
   NEXT_PUBLIC_ZKBIO_API_URL=https://192.168.183.114:8098/api
   NEXT_PUBLIC_ZKBIO_API_TOKEN=8D1E99707293387C5B3BFC7291AD38CB
   ```
4. Run the development server: `npm run dev`
5. Open http://localhost:3000

### API Proxy Configuration

The application uses Next.js API proxy routes to handle CORS and SSL certificate issues:

- **Person Data**: `/api/persons` â†’ ZKBio `/api/v2/person/getPersonList`
- **Access Levels**: `/api/access-levels` â†’ ZKBio `/api/v2/accLevel/list`

The proxy automatically:
- Bypasses CORS restrictions
- Handles self-signed SSL certificates
- Formats ZKBio API responses
- Provides error handling and logging

## Usage

- **Home Page**: View registered personnel and register new ones.
- **Registration Form**: Enter name, optional card number, and fingerprint template (base64).
- Data is synced with ZKTECO BioCVSecurity for biometric access control.

## API Endpoints

The app provides RESTful API endpoints for account management, stored in SQLite.

### Accounts
- `GET /api/accounts` - Retrieve all accounts
- `POST /api/accounts` - Create a new account (requires JSON body with account details)
- `GET /api/accounts/{id}` - Retrieve a specific account by ID
- `PUT /api/accounts/{id}` - Update an account's status or details
- `DELETE /api/accounts/{id}` - Delete an account

## Current Application Status

### âœ… Fully Operational Features

#### User Management System
- **Data Loading**: Personnel information loads automatically from ZKBio API
- **User Table**: Professional table with search, filter, and pagination
- **Real-time Sync**: Data refreshes automatically every 5 minutes
- **Manual Refresh**: Global and component-level refresh buttons
- **Add User Modal**: Form for creating new users (UI ready, API integration pending)

#### API Integration Status
- **Person Data**: âœ… 5 users successfully loaded and displayed
- **Access Levels**: âœ… 1 access level loaded
- **Proxy Routes**: âœ… CORS and SSL certificate issues resolved
- **Error Handling**: âœ… Comprehensive error handling and recovery
- **Data Refresh**: âœ… Automatic and manual refresh capabilities

#### UI/UX Enhancements
- **Skeleton Loading**: Professional loading states during data fetch
- **Enhanced Notifications**: Progress bars and multiple notification types
- **Form Validation**: Real-time validation with custom rules
- **Error Boundaries**: Graceful error handling for API failures
- **Responsive Design**: Mobile-friendly interface

### ðŸ“Š Current Data Status

#### Person Records (5 total)
```json
[
  {"pin": "23510009090", "name": "George Mrema", "dept": "PRIVATE BANKING CUSTOMER"},
  {"pin": "23510009090S1", "name": "Zainab Gamaru", "dept": "SPOUSE PRIVATE BANKING"},
  {"pin": "902190", "name": "Calvin Okumu", "dept": "PRIVATE BANKING CUSTOMER"},
  {"pin": "902190S1", "name": "Mary Doe", "dept": "SPOUSE PRIVATE BANKING"},
  {"pin": "902190S2", "name": "Jane Doe", "dept": "SPOUSE PRIVATE BANKING"}
]
```

#### Access Levels (1 total)
```json
[{"id": "402880f39ae893ad019ae895fe3d0463", "name": "General"}]
```

### ðŸ”„ Data Synchronization

- **Page Refresh**: Data loads automatically on browser refresh
- **Auto Refresh**: Background sync every 5 minutes
- **Manual Refresh**: Header and component refresh buttons
- **Timestamp Display**: Shows when data was last updated
- **Loading States**: Visual feedback during data operations

### ZKTECO Integration

- **API Setup Guide**: `docs/zkbio-api-setup-guide.md` - Complete setup instructions for ZKBio API authorization
- **API Reference**: `docs/zkteco-api-reference-latest.md` - Full API documentation with working endpoints
- **API Summary**: `docs/zkteco-api-summary.md` - Overview of ZKTECO BioCVSecurity API integration status

## Development

- Lint: `npm run lint`
- Build: `npm run build`
- Start production: `npm start`

## Notes

- Fingerprint templates require base64 encoding; integrate with biometric devices for capture.
- Ensure ZKTECO server is accessible and API token is valid.